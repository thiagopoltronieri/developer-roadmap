import{g as _}from"./browser.bcc09af3.js";import{h as n,p as E}from"./hooks.module.6eb5c72e.js";import{a as x,d as C}from"./http.82ebf0f1.js";import{p as d}from"./page.c1a8a472.js";import{E as L}from"./external-link.a7a2cda9.js";import{R as U}from"./roadmap.e17ba5ff.js";import{S as D,U as z}from"./SelectRoadmapModal.74929069.js";import{u as G}from"./index.164edc2c.js";import{a as Y}from"./team.12f2469e.js";import{u as q}from"./use-toast.fb52de5d.js";import{o as e}from"./jsxRuntime.module.c6f75409.js";import"./preact.module.346aa314.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./index.es.ebad3893.js";import"./Spinner.5007fa01.js";import"./resource-progress.e28c933e.js";/* empty css                       */import"./use-outside-click.63bf96d6.js";import"./use-keydown.55c06bff.js";import"./close.3a539829.js";import"./toast.1fe7142d.js";const B="/_astro/plus.1630ea32.svg";function pe(){const{t}=_(),m=G(Y),s=q(),[A,g]=n(!0),[b,f]=n(""),[k,c]=n(!1),[h,v]=n(""),[p,I]=n(),[l,u]=n([]),[R,T]=n([]);async function $(){const{error:o,response:r}=await x("/pages.json");if(o){s.error(o.message||"Something went wrong");return}if(!r)return[];const a=r.filter(i=>i.group==="Roadmaps").sort((i,y)=>i.title==="Android"?1:i.title.localeCompare(y.title));return T(a),r}async function M(o){const{response:r,error:a}=await x(`https://api.roadmap.sh/v1-get-team/${o}`);if(a||!r){s.error("Error loading team"),window.location.href="/account";return}I(r)}async function j(o){const{error:r,response:a}=await x(`https://api.roadmap.sh/v1-get-team-resource-config/${o}`);if(r||!Array.isArray(a)){console.error(r);return}u(a)}E(()=>{t&&(g(!0),Promise.all([M(t),j(t),$()]).finally(()=>{d.set(""),g(!1)}))},[t]);async function P(o){if(!p?._id)return;s.loading("Deleting roadmap"),d.set("Deleting roadmap from team");const{error:r,response:a}=await C(`https://api.roadmap.sh/v1-delete-team-resource-config/${p._id}`,{resourceId:o,resourceType:"roadmap"});if(r||!a){s.error(r?.message||"Something went wrong");return}s.success("Roadmap removed"),u(a)}async function S(o){if(!t)return;s.loading("Adding roadmap"),d.set("Adding roadmap"),g(!0);const{error:r,response:a}=await C(`https://api.roadmap.sh/v1-update-team-resource-config/${t}`,{teamId:t,resourceId:o,resourceType:"roadmap",removed:[]});if(r||!a){s.error(r?.message||"Error adding roadmap");return}u(a),s.success("Roadmap added")}async function N(o){d.set("Removing roadmap"),P(o).finally(()=>{d.set("")})}if(!p)return null;const w=k&&e(D,{onClose:()=>c(!1),teamResourceConfig:l,allRoadmaps:R,teamId:t,onRoadmapAdd:o=>{S(o).finally(()=>{d.set("")})},onRoadmapRemove:o=>{confirm("Are you sure you want to remove this roadmap?")&&N(o).finally(()=>{})}});return l.length===0&&!A?e("div",{className:"flex flex-col items-center p-4 py-20",children:[w,e("img",{alt:"roadmap",src:U,className:"mb-4 h-24 w-24 opacity-10"}),e("h3",{className:"mb-1 text-2xl font-bold text-gray-900",children:"No roadmaps"}),e("p",{className:"text-base text-gray-500",children:m?"Add a roadmap to start tracking your team":"Ask your team admin to add some roadmaps"}),m&&e("button",{className:"mt-4 rounded-lg bg-black px-4 py-2 font-medium text-white hover:bg-gray-900",onClick:()=>c(!0),children:"Add roadmap"})]}):e("div",{children:[w,e("div",{className:"mb-3 flex items-center justify-between",children:[e("span",{className:"text-gray-400",children:[l.length," roadmap(s) selected"]}),m&&e("button",{className:"flex items-center gap-1.5 rounded-lg px-4 py-2 text-sm font-medium text-gray-500 underline hover:bg-gray-100 hover:text-gray-900",onClick:()=>c(!0),children:"Add / Remove Roadmaps"})]}),e("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[h&&e(z,{onClose:()=>v(""),resourceId:h,resourceType:"roadmap",teamId:p?._id,setTeamResourceConfig:u,defaultRemovedItems:l.find(o=>o.resourceId===h)?.removed||[]}),l.map(o=>{const{resourceId:r,removed:a}=o,i=R.find(y=>y.id===r)?.title||"...";return e("div",{className:"flex flex-col items-start rounded-md border border-gray-300",children:[e("div",{className:"w-full px-3 py-4",children:[e("a",{href:`/${r}?t=${t}`,className:"group mb-0.5 flex items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:[i,e("img",{alt:"link",src:L,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})]}),a.length>0?e("span",{className:"text-xs leading-none text-gray-900",children:[a.length," topic",a.length>1?"s":""," removed"]}):e("span",{className:"text-xs italic leading-none text-gray-400/60",children:"No changes made .."})]}),m&&e("div",{className:"flex w-full justify-between px-3 pb-3 pt-2",children:[e("button",{type:"button",className:"text-xs text-gray-500 underline hover:text-black focus:outline-none",onClick:()=>{f(""),v(r)},children:"Customize"}),b!==r&&e("button",{type:"button",className:"text-xs text-red-500 underline hover:text-black focus:outline-none disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:text-red-500",onClick:()=>f(r),children:"Remove"}),b===r&&e("span",{className:"text-xs",children:["Are you sure?"," ",e("button",{onClick:()=>N(r),className:"mx-0.5 text-red-500 underline underline-offset-1",children:"Yes"})," ",e("button",{onClick:()=>f(""),className:"text-red-500 underline underline-offset-1",children:"No"})]})]})]})}),m&&e("button",{onClick:()=>c(!0),className:"group flex min-h-[110px] flex-col items-center justify-center rounded-md border border-dashed border-gray-300 transition-colors hover:border-gray-600 hover:bg-gray-50",children:[e("img",{alt:"add",src:B,className:"mb-1 h-6 w-6 opacity-20 transition-opacity group-hover:opacity-100"}),e("span",{className:"text-sm text-gray-400 transition-colors focus:outline-none group-hover:text-black",children:"Add Roadmap"})]})]})]})}export{pe as TeamRoadmaps};
