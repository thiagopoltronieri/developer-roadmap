import{a as w,T as L}from"./jwt.1b92699e.js";import{h as $,a as C}from"./http.64a7434f.js";async function I(o){const{topicId:e,resourceType:t,resourceId:r}=o,{done:s=[]}=await p(t,r)||{};return s?.includes(e)}async function M(o){const{topicId:e,resourceType:t,resourceId:r}=o,s=await p(t,r);return s?.done?.includes(e)?"done":s?.learning?.includes(e)?"learning":s?.skipped?.includes(e)?"skipped":"pending"}async function N(o,e){const{topicId:t,resourceType:r,resourceId:s}=o,{response:n,error:i}=await $("https://api.roadmap.sh/v1-update-resource-progress",{topicId:t,resourceType:r,resourceId:s,progress:e});if(i||!n?.done||!n?.learning)throw new Error(i?.message||"Something went wrong");return y(r,s,n.done,n.learning,n.skipped),n}async function p(o,e){if(!w.get(L))return{done:[],learning:[],skipped:[]};const t=`${o}-${e}-progress`,r=`${o}-${e}-favorite`,s=localStorage.getItem(r),n=JSON.parse(s||"0")===1,i=localStorage.getItem(t),a=JSON.parse(i||"null"),d=a?.timestamp,l=new Date().getTime()-parseInt(d||"0",10)>15*60*1e3;return!a||l?x(o,e):(window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:o,resourceId:e,isFavorite:n}})),a)}async function x(o,e){const{response:t,error:r}=await C("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:o,resourceId:e});return r||!t?(console.error(r),{done:[],learning:[],skipped:[]}):(y(o,e,t?.done||[],t?.learning||[],t?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:o,resourceId:e,isFavorite:t.isFavorite}})),t)}function y(o,e,t,r,s){localStorage.setItem(`${o}-${e}-progress`,JSON.stringify({done:t,learning:r,skipped:s,timestamp:new Date().getTime()}))}function R(o,e=document){const t=[];return e.querySelectorAll(`[data-group-id$="-${o}"]`).forEach(r=>{const s=r?.dataset?.groupId||"";new RegExp(`^\\d+-${o}$`).test(s)&&t.push(r)}),e.querySelectorAll(`[data-group-id="${o}"]`).forEach(r=>{t.push(r)}),e.querySelectorAll(`[data-group-id="check:${o}"]`).forEach(r=>{t.push(r)}),t}function u(o,e){const t=e==="learning",r=e==="skipped",s=e==="done",n=e==="removed";R(o).forEach(a=>{s?(a.classList.add("done"),a.classList.remove("learning","skipped")):t?(a.classList.add("learning"),a.classList.remove("done","skipped")):r?(a.classList.add("skipped"),a.classList.remove("done","learning")):n?(a.classList.add("removed"),a.classList.remove("done","learning","skipped")):a.classList.remove("done","skipped","learning","removed")})}function D(){const o=document.querySelectorAll(".clickable-group");for(const e of o)e.classList.remove("done","skipped","learning","removed")}async function F(o,e){const{done:t=[],learning:r=[],skipped:s=[]}=await p(o,e)||{};t.forEach(n=>{u(n,"done")}),r.forEach(n=>{u(n,"learning")}),s.forEach(n=>{u(n,"skipped")}),T()}function T(){const o=document.querySelectorAll("[data-progress-nums-container]"),e=document.querySelectorAll("[data-progress-nums]");if(o.length===0||e.length===0)return;const t=document.querySelectorAll(".clickable-group").length,r=document.querySelectorAll('[data-group-id^="ext_link:"]').length,s=document.querySelectorAll('[data-group-id^="json:"]').length,n=document.querySelectorAll('[data-group-id^="check:"]').length,i=document.querySelectorAll('[data-group-id^="check:"].done').length,a=document.querySelectorAll('[data-group-id^="check:"].learning').length,d=document.querySelectorAll('[data-group-id^="check:"].skipped').length,g=document.querySelectorAll(".clickable-group.removed").length,l=t-r-s-n-g,h=document.querySelectorAll('.clickable-group.done:not([data-group-id^="ext_link:"])').length-i,A=document.querySelectorAll(".clickable-group.learning").length-a,m=document.querySelectorAll(".clickable-group.skipped").length-d,f=document.querySelectorAll("[data-progress-done]");f.length>0&&f.forEach(c=>c.innerHTML=`${h}`);const k=document.querySelectorAll("[data-progress-learning]");k.length>0&&k.forEach(c=>c.innerHTML=`${A}`);const S=document.querySelectorAll("[data-progress-skipped]");S.length>0&&S.forEach(c=>c.innerHTML=`${m}`);const E=document.querySelectorAll("[data-progress-total]");E.length>0&&E.forEach(c=>c.innerHTML=`${l}`);const q=Math.round((h+m)/l*100),v=document.querySelectorAll("[data-progress-percentage]");v.length>0&&v.forEach(c=>c.innerHTML=`${q}`),o.forEach(c=>c.classList.remove("striped-loader")),e.forEach(c=>{c.classList.remove("opacity-0")})}export{u as a,T as b,D as c,M as g,I as i,F as r,R as t,N as u};
