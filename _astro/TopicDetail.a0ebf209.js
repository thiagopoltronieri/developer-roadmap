import{j as e}from"./jsx-runtime.391947bd.js";import{r as s}from"./index.ed373d49.js";import{C as B}from"./close.bb7a0ac2.js";import{S as D}from"./spinner.6a5ba5e9.js";import{u as C}from"./use-keydown.0305ad6b.js";import{u as M}from"./use-outside-click.54b69c89.js";import{h as G,a as z}from"./http.64a7434f.js";import{i as $}from"./jwt.1b92699e.js";import{g as _,u as A,a as q,b as H,i as O}from"./resource-progress.495f7d07.js";import{p as R,s as K}from"./page.c1a8a472.js";import{s as E}from"./popup.a359f713.js";import{u as P}from"./use-toast.fb52de5d.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";function Q(d){s.useEffect(()=>{function n(c){const{resourceType:o,resourceId:i,topicId:u}=c.detail;d({resourceType:o,resourceId:i,topicId:u})}return window.addEventListener("roadmap.topic.click",n),window.addEventListener("best-practice.topic.click",n),()=>{window.removeEventListener("roadmap.topic.click",n),window.removeEventListener("best-practice.topic.click",n)}},[])}function W(d){s.useEffect(()=>{function n(c){const{resourceType:o,resourceId:i,topicId:u}=c.detail;d({resourceType:o,resourceId:i,topicId:u})}return window.addEventListener("roadmap.topic.toggle",n),window.addEventListener("best-practice.topic.toggle",n),()=>{window.removeEventListener("best-practice.topic.toggle",n)}},[])}const J={src:"/_astro/down.db2d1800.svg",width:24,height:24,format:"svg"},S={done:"bg-green-500",learning:"bg-yellow-500",pending:"bg-gray-300",skipped:"bg-black",removed:""};function V(d){const{topicId:n,resourceId:c,resourceType:o,onClose:i}=d,u=P(),[h,a]=s.useState(!0),[t,p]=s.useState("pending"),[y,r]=s.useState(!1),x=s.useRef(null);M(x,()=>{r(!1)});const m=s.useMemo(()=>!$(),[]);s.useEffect(()=>{!n||!c||!o||(a(!0),_({topicId:n,resourceId:c,resourceType:o}).then(j=>{a(!1),p(j)}).catch(console.error))},[n,c,o]),C("d",()=>{if(t==="done"){i();return}l("done")},[t]),C("l",()=>{if(t==="learning"){i();return}l("learning")},[t]),C("s",()=>{if(t==="skipped"){i();return}l("skipped")},[t]),C("r",()=>{if(console.log(t),t==="pending"){i();return}l("pending")},[t]);const l=j=>{if(m){i(),E();return}a(!0),A({topicId:n,resourceId:c,resourceType:o},j).then(()=>{p(j),i(),q(n,j),H()}).catch(T=>{u.error(T.message||"Error updating progress"),console.error(T)}).finally(()=>{a(!1)})},w=["pending","learning","done"].includes(t),v=["skipped","pending","learning"].includes(t),g=["done","skipped","pending"].includes(t),I=["skipped","done","learning"].includes(t);return h?e.jsxs("button",{className:"inline-flex cursor-default items-center rounded-md border border-gray-300 bg-white p-1 px-2 text-sm text-black",children:[e.jsx("img",{alt:"Check",className:"h-4 w-4 animate-spin",src:D.src}),e.jsx("span",{className:"ml-2",children:"Updating Status.."})]}):e.jsxs("div",{className:"relative inline-flex rounded-md border border-gray-300",children:[e.jsxs("span",{className:"inline-flex cursor-default items-center  p-1 px-2 text-sm text-black",children:[e.jsx("span",{className:"flex h-2 w-2",children:e.jsx("span",{className:`relative inline-flex h-2 w-2 rounded-full ${S[t]}`})}),e.jsx("span",{className:"ml-2 capitalize",children:t==="learning"?"In Progress":t})]}),e.jsxs("button",{className:"inline-flex cursor-pointer items-center rounded-br-md rounded-tr-md border-l border-l-gray-300 bg-gray-100 p-1 px-2 text-sm text-black hover:bg-gray-200",onClick:()=>r(!0),children:[e.jsx("span",{className:"mr-0.5",children:"Update Status"}),e.jsx("img",{alt:"Check",className:"h-4 w-4",src:J.src})]}),y&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 flex min-w-[160px] flex-col divide-y rounded-md border border-gray-200 bg-white shadow-md [&>button:first-child]:rounded-t-md [&>button:last-child]:rounded-b-md",ref:x,children:[v&&e.jsxs("button",{className:"inline-flex justify-between px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>l("done"),children:[e.jsxs("span",{children:[e.jsx("span",{className:`mr-2 inline-block h-2 w-2 rounded-full ${S.done}`}),"Done"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"D"})]}),g&&e.jsxs("button",{className:"inline-flex justify-between px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>l("learning"),children:[e.jsxs("span",{children:[e.jsx("span",{className:`mr-2 inline-block h-2 w-2 rounded-full ${S.learning}`}),"In Progress"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"L"})]}),I&&e.jsxs("button",{className:"inline-flex justify-between px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>l("pending"),children:[e.jsxs("span",{children:[e.jsx("span",{className:`mr-2 inline-block h-2 w-2 rounded-full ${S.pending}`}),"Reset"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"R"})]}),w&&e.jsxs("button",{className:"inline-flex justify-between px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>l("skipped"),children:[e.jsxs("span",{children:[e.jsx("span",{className:`mr-2 inline-block h-2 w-2 rounded-full ${S.skipped}`}),"Skip"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"S"})]})]})]})}function X(d){const{isLast:n,totalCount:c,onAdd:o,onRemove:i,onChange:u,id:h,title:a,link:t}=d,p=s.useRef(null),[y,r]=s.useState(""),[x,m]=s.useState(a),[l,w]=s.useState(t);s.useEffect(()=>{p?.current&&p.current.focus()},[]),s.useEffect(()=>{u({id:h,title:x,link:l})},[x,l]);const v=n&&c<5;return e.jsxs("div",{className:"relative mb-3 rounded-md border p-3",children:[e.jsx("p",{className:`mb-1 text-xs uppercase ${y==="title"?"text-black":"text-gray-400"}`,children:"Resource Title"}),e.jsx("input",{ref:p,type:"text",required:!0,className:"block w-full rounded-md border p-2 text-sm focus:border-gray-400 focus:outline-none",placeholder:"e.g. Introduction to RESTful APIs",onFocus:()=>r("title"),onBlur:()=>r(""),onChange:g=>m(g.target.value)}),e.jsx("p",{className:`mb-1 mt-3 text-xs uppercase ${y==="link"?"text-black":"text-gray-400"}`,children:"Resource Link"}),e.jsx("input",{type:"url",required:!0,className:"block w-full rounded-md border p-2 text-sm focus:border-gray-400 focus:outline-none",placeholder:"e.g. https://roadmap.sh/guides/some-url",onFocus:()=>r("link"),onBlur:()=>r(""),onChange:g=>w(g.target.value)}),e.jsxs("div",{className:"mb-0 mt-3 flex gap-3",children:[c!==1&&e.jsx("button",{onClick:g=>{g.preventDefault(),i()},className:"rounded-md text-sm font-semibold text-red-500 underline underline-offset-2 hover:text-red-800",children:"- Remove Link"}),v&&e.jsx("button",{onClick:g=>{g.preventDefault(),o()},className:"rounded-md text-sm font-semibold text-gray-600 underline underline-offset-2 hover:text-black",children:"+ Add another Link"})]})]})}function Y(d){const{onClose:n,resourceType:c,resourceId:o,topicId:i}=d,u=P(),[h,a]=s.useState(!1),[t,p]=s.useState([{id:new Date().getTime(),title:"",link:""}]);async function y(r){r.preventDefault(),a(!0);const{response:x,error:m}=await G("https://api.roadmap.sh/v1-contribute-link",{resourceType:c,resourceId:o,topicId:i,links:t});if(a(!1),!x||m){u.error(m?.message||"Something went wrong. Please try again.");return}n("Thanks for your contribution! We will review it shortly.")}return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 mt-2 rounded-md border bg-gray-100 p-3",children:[e.jsx("h1",{className:"mb-2 text-2xl font-bold",children:"Guidelines"}),e.jsxs("ul",{className:"flex flex-col gap-1 text-sm text-gray-700",children:[e.jsx("li",{children:"Content should only be in English."}),e.jsx("li",{children:"Do not add things you have not evaluated personally."}),e.jsx("li",{children:"It should strictly be relevant to the topic."}),e.jsx("li",{children:"It should not be paid or behind a signup."}),e.jsx("li",{children:"Quality over quantity. Smaller set of quality links is preferred."})]})]}),e.jsxs("form",{onSubmit:y,children:[t.map((r,x)=>e.jsx(X,{id:r.id,title:r.title,link:r.link,isLast:x===t.length-1,totalCount:t.length,onChange:m=>{p(t.map(l=>l.id===r.id?m:l))},onRemove:()=>{p(t.filter(m=>m.id!==r.id))},onAdd:()=>{p([...t,{id:new Date().getTime(),title:"",link:""}])}},r.id)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:h,type:"submit",className:"block w-full rounded-md bg-gray-800 p-2 text-sm text-white hover:bg-black disabled:cursor-not-allowed disabled:bg-gray-400",children:h?"Please wait ...":"Submit"}),e.jsx("button",{className:"block w-full rounded-md border border-red-500 p-2 text-sm text-red-600 hover:bg-red-600 hover:text-white",onClick:r=>{r.preventDefault(),n()},children:"Cancel"})]})]})]})}function ge(){const[d,n]=s.useState(""),[c,o]=s.useState(!1),[i,u]=s.useState(!1),[h,a]=s.useState(!1),[t,p]=s.useState(""),[y,r]=s.useState(""),x=P(),m=s.useMemo(()=>!$(),[]),l=s.useRef(null),[w,v]=s.useState(""),[g,I]=s.useState(""),[j,T]=s.useState("roadmap");return M(l,()=>{o(!1),a(!1)}),C("Escape",()=>{o(!1),a(!1)}),W(({topicId:f,resourceType:N,resourceId:k})=>{if(m){E();return}R.set("Updating"),O({topicId:f,resourceId:k,resourceType:N}).then(b=>A({topicId:f,resourceId:k,resourceType:N},b?"pending":"done")).then(({done:b=[]})=>{q(f,b.includes(f)?"done":"pending"),H()}).catch(b=>{x.error(b.message),console.error(b)}).finally(()=>{R.set("")})}),Q(({topicId:f,resourceType:N,resourceId:k})=>{u(!0),o(!0),K.set(!0),n(""),v(f),T(N),I(k);const b=f.replaceAll(":","/"),U=N==="roadmap"?`/${k}/${b}`:`/best-practices/${k}/${b}`;z(U,{},{headers:{Accept:"text/html"}}).then(({response:L})=>{if(!L){p("Topic not found.");return}const F=new DOMParser().parseFromString(L,"text/html")?.getElementById("main-content")?.outerHTML||"";u(!1),r(F)}).catch(L=>{p("Something went wrong. Please try again later."),u(!1)})}),c?e.jsxs("div",{children:[e.jsxs("div",{ref:l,className:"fixed right-0 top-0 z-40 h-screen w-full overflow-y-auto bg-white p-4 sm:max-w-[600px] sm:p-6",children:[i&&e.jsx("div",{className:"flex w-full justify-center",children:e.jsx("img",{src:D.src,alt:"Loading",className:"h-6 w-6 animate-spin fill-blue-600 text-gray-200 sm:h-12 sm:w-12"})}),!i&&h&&e.jsx(Y,{resourceType:j,resourceId:g,topicId:w,onClose:f=>{f&&n(f),a(!1)}}),!h&&!i&&!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(V,{topicId:w,resourceId:g,resourceType:j,onClose:()=>{o(!1),a(!1)}}),e.jsx("button",{type:"button",id:"close-topic",className:"absolute right-2.5 top-2.5 inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900",onClick:()=>{o(!1),a(!1)},children:e.jsx("img",{alt:"Close",className:"h-5 w-5",src:B.src})})]}),e.jsx("div",{id:"topic-content",className:"prose prose-quoteless prose-h1:mb-2.5 prose-h1:mt-7 prose-h2:mb-3 prose-h2:mt-0 prose-h3:mb-[5px] prose-h3:mt-[10px] prose-p:mb-2 prose-p:mt-0 prose-blockquote:font-normal prose-blockquote:not-italic prose-blockquote:text-gray-700 prose-li:m-0 prose-li:mb-0.5",dangerouslySetInnerHTML:{__html:y}}),e.jsxs("div",{className:"mt-8 flex-1 border-t",children:[e.jsxs("p",{className:"mb-2 mt-2 text-sm leading-relaxed text-gray-400",children:["Help others learn by submitting links to learn more about this topic"," "]}),e.jsx("button",{onClick:()=>{if(m){o(!1),E();return}a(!0)},disabled:!!d,className:"block w-full rounded-md bg-gray-800 p-2 text-sm text-white transition-colors hover:bg-black hover:text-white disabled:bg-green-200 disabled:text-black",children:d||"Submit a Link"})]})]})]}),e.jsx("div",{className:"fixed inset-0 z-30 bg-gray-900 bg-opacity-50 dark:bg-opacity-80"})]}):null}export{ge as TopicDetail};
