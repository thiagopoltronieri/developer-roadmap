import{j as e}from"./jsx-runtime.391947bd.js";import{r}from"./index.ed373d49.js";import{a as $}from"./http.64a7434f.js";import{D as C}from"./dropdown.e91a0d66.js";import{c as k,r as g,a as D,b as E}from"./resource-progress.495f7d07.js";import{g as I,d as R,s as A}from"./browser.bcc09af3.js";import{u as O}from"./use-outside-click.54b69c89.js";import{u as U}from"./use-keydown.0305ad6b.js";import{i as _}from"./jwt.1b92699e.js";import{u as L}from"./use-auth.2b975076.js";import{u as z}from"./use-toast.fb52de5d.js";import"./toast.1fe7142d.js";import"./index.a98c85f5.js";function ee(w){const{t:d}=I();if(!_())return;const{resourceId:o,resourceType:i}=w,m=L(),b=z(),u=r.useRef(null),[j,v]=r.useState(!0),[f,a]=r.useState(!1),[y,N]=r.useState(0),[p,T]=r.useState([]),[s,l]=r.useState(null);let c;const h=s?s.team.avatar:m?.avatar,x=s?s.team.name:m?.name;s?.team.avatar?c=!0:c=!!(!s&&m?.avatar),O(u,()=>{a(!1)}),U("Escape",()=>{a(!1)});async function P(){const{response:t,error:n}=await $(`https://api.roadmap.sh/v1-get-team-versions?${new URLSearchParams({resourceId:o,resourceType:i})}`);if(n||!t){b.error(n?.message||"Failed to load team versions.");return}if(T(t),d){const S=t.find(V=>V.team._id===d)||null;l(S)}setTimeout(()=>{v(!1),setTimeout(()=>{N(100)},50)},0)}return r.useEffect(()=>{P().finally(()=>{})},[]),r.useEffect(()=>{if(k(),!s){R("t"),g(i,o).then();return}A({t:s.team._id}),g(i,o).then(()=>{s.config?.removed?.forEach(t=>{D(t,"removed")}),E()})},[s]),j||!p.length?null:e.jsxs("div",{className:`relative h-7 transition-opacity duration-500 sm:h-auto opacity-${y}`,children:[e.jsxs("button",{className:"inline-flex h-7 items-center justify-between gap-1 rounded-md border px-1.5 py-1.5 text-xs font-medium hover:bg-gray-50 focus:outline-0 sm:h-8 sm:w-40 sm:px-3 sm:text-sm",onClick:()=>a(!f),children:[e.jsxs("div",{className:"hidden w-full items-center justify-between sm:flex",children:[e.jsx("span",{className:"truncate",children:s?.team.name||"Team Versions"}),e.jsx("img",{alt:"Dropdown",src:C.src,className:"h-3 w-3 sm:h-4 sm:w-4"})]}),e.jsx("div",{className:"sm:hidden",children:c?e.jsx("img",{src:h?`https://dodrc8eu8m09s.cloudfront.net/avatars/${h}`:"/images/default-avatar.png",alt:`${x} Avatar`,className:"h-5 w-5 rounded-full object-cover"}):e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-gray-200 text-xs",children:x?.charAt(0).toUpperCase()})})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 block bg-black/20 sm:hidden","aria-hidden":"true"}),e.jsxs("div",{ref:u,className:"fixed bottom-0 left-0 z-50 mt-1 h-fit w-full overflow-hidden rounded-md bg-white py-0.5 shadow-md sm:absolute sm:left-0 sm:right-0 sm:top-full sm:border",children:[e.jsx("button",{className:`flex h-8 w-full items-center justify-between px-3 py-1.5 text-xs font-medium hover:bg-gray-100 sm:text-sm ${s?"bg-white":"bg-gray-100"}`,onClick:()=>{l(null),a(!1)},children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("span",{className:"truncate",children:"Personal"})})}),p.map(t=>{const n=s?.team._id===t.team._id;return e.jsx("button",{className:`flex h-8 w-full items-center justify-between px-3 py-1.5 text-xs font-medium hover:bg-gray-100 sm:text-sm ${n?"bg-gray-100":"bg-white"}`,onClick:()=>{l(t),a(!1)},children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("span",{className:"truncate",children:t.team.name})})},t?.team?._id)})]})]})]})}export{ee as TeamVersions};
