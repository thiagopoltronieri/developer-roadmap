import{j as e}from"./jsx-runtime.391947bd.js";import{r as u}from"./index.ed373d49.js";import{p as o}from"./page.c1a8a472.js";import{u as q}from"./use-auth.2b975076.js";import{c as P,h as U,a as $}from"./http.64a7434f.js";import{u as F}from"./use-toast.fb52de5d.js";import{C as I}from"./copy.7975d749.js";import{u as R}from"./use-copy-text.09bf10d7.js";import{D as C,A}from"./AddedUserIcon.83088bac.js";import{T as w}from"./TrashIcon.e0cd36d1.js";import{U as T}from"./user.10bb57ac.js";import{UserProgressModal as L}from"./UserProgressModal.11187f3a.js";import{u as E}from"./use-outside-click.54b69c89.js";import"./index.a98c85f5.js";import"./jwt.1b92699e.js";import"./toast.1fe7142d.js";import"./index.es.ebad3893.js";/* empty css                       */import"./use-keydown.0305ad6b.js";import"./resource-progress.495f7d07.js";import"./close.bb7a0ac2.js";import"./browser.bcc09af3.js";import"./Spinner.cc2f813e.js";import"./ErrorIcon.206ac592.js";function N(c){const{additionalClasses:s="mr-2 w-[20px] h-[20px]"}=c;return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`relative ${s}`,children:[e.jsx("path",{d:"M14 19a6 6 0 0 0-12 0"}),e.jsx("circle",{cx:"8",cy:"9",r:"4"}),e.jsx("line",{x1:"19",x2:"19",y1:"8",y2:"14"}),e.jsx("line",{x1:"22",x2:"16",y1:"11",y2:"11"})]})}const D={src:"/_astro/user-plus.59c68015.svg",width:24,height:24,format:"svg"};function G(c){const{befriendUrl:s}=c,{isCopied:n,copyText:l}=R();return e.jsx("div",{className:"rounded-md",children:e.jsxs("div",{className:"mx-auto flex flex-col items-center p-7 text-center",children:[e.jsx("img",{alt:"no friends",src:D.src,className:"mb-2 h-[60px] w-[60px] opacity-10 sm:h-[120px] sm:w-[120px]"}),e.jsx("h2",{className:"text-lg font-bold sm:text-xl",children:"Invite your Friends"}),e.jsx("p",{className:"mb-4 mt-1 max-w-[400px] text-sm leading-relaxed text-gray-500",children:"Share the unique link below with your friends to track their skills and progress."}),e.jsxs("div",{className:"flex w-full max-w-[352px] items-center justify-center gap-2 rounded-lg border-2 p-1 text-sm",children:[e.jsx("input",{onClick:a=>{a.currentTarget.select(),l(s)},type:"text",value:s,className:"w-full border-none bg-transparent px-1.5 outline-none",readOnly:!0}),e.jsxs("button",{className:`flex items-center justify-center gap-1 rounded-md border-0 p-2 px-4 text-sm text-black ${n?"bg-green-300 hover:bg-green-300":"bg-gray-200 hover:bg-gray-300"}`,onClick:()=>{l(s)},children:[e.jsx("img",{src:I.src,className:"h-4 w-4",alt:"Invite Friends"}),n?"Copied":"Copy"]})]})]})})}function M(c){const{friend:s,onShowResourceProgress:n,onReload:l}=c,a=F(),[m,f]=u.useState();async function d(r,p){o.set("Please wait...");const{response:g,error:h}=await P(`https://api.roadmap.sh/v1-delete-friend/${r}`,{});if(h||!g){a.error(h?.message||"Something went wrong");return}a.success(p),l()}async function y(r,p){o.set("Please wait...");const{response:g,error:h}=await U(`https://api.roadmap.sh/v1-add-friend/${r}`,{});if(h||!g){a.error(h?.message||"Something went wrong");return}a.success(p),l()}const i=(s.roadmaps||[]).sort((r,p)=>p.done-r.done),[j,b]=u.useState(!1);return s.status,e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e.jsxs("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e.jsx("img",{src:s.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"h-8 w-8 rounded-full"}),e.jsxs("div",{className:"inline-grid w-full",children:[e.jsx("h3",{className:"truncate font-medium",children:s.name}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:s.email})]})]}),s.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(j?i:i.slice(0,4)).map(r=>e.jsxs("button",{onClick:()=>n(r.resourceId),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"inline-grid",children:e.jsx("span",{className:"truncate",children:r.title})}),e.jsxs("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[r.done," / ",r.total]})]}),e.jsx("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${r.done/r.total*100}%`}})]},r.resourceId)),i.length>4&&!j&&e.jsxs("button",{onClick:()=>b(!0),className:"text-xs text-gray-400 underline",children:["+ ",i.length-4," more"]}),j&&e.jsx("button",{onClick:()=>b(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),i.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]}),e.jsxs(e.Fragment,{children:[m!=="accepted"&&e.jsxs("button",{className:"flex w-full items-center justify-center border-t py-2 text-sm font-medium text-red-700 hover:bg-red-50/50 hover:text-red-500",onClick:()=>{f("accepted")},children:[e.jsx(w,{className:"mr-1 h-4 w-4"}),"Remove Friend"]}),m==="accepted"&&e.jsxs("span",{className:"flex w-full items-center justify-center border-t py-2 text-sm text-red-700",children:["Are you sure?"," ",e.jsx("button",{className:"ml-2 font-medium text-red-700 underline underline-offset-2 hover:text-red-500",onClick:()=>{d(s.userId,"Friend removed").finally(()=>{o.set("")})},children:"Yes"})," ",e.jsx("button",{className:"ml-2 font-medium text-red-700 underline underline-offset-2 hover:text-red-500",onClick:()=>{f(void 0)},children:"No"})]})]})]}),s.status==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full flex-grow items-center justify-center",children:e.jsxs("span",{className:" flex flex-col items-center text-red-500",children:[e.jsx(C,{additionalClasses:"mr-2 h-8 w-8 mb-1"}),"Request Rejected"]})}),e.jsxs("span",{className:"flex cursor-default items-center justify-center border-t py-2 text-center text-sm",children:["Changed your mind?"," ",e.jsx("button",{className:"ml-2 font-medium text-red-700 underline underline-offset-2 hover:text-red-500",onClick:()=>{y(s.userId,"Friend request accepted").finally(()=>{o.set("")})},children:"Accept"})]})]}),s.status==="got_rejected"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full flex-grow items-center justify-center",children:e.jsxs("span",{className:" flex flex-col items-center text-sm text-red-500",children:[e.jsx(C,{additionalClasses:"mr-2 h-8 w-8 mb-1"}),"Request Rejected"]})}),e.jsx("span",{className:"flex cursor-default items-center justify-center border-t py-2.5 text-center text-sm",children:e.jsxs("button",{className:"ml-2 flex items-center font-medium text-red-700 underline underline-offset-2 hover:text-red-500",onClick:()=>{d(s.userId,"Friend request removed").finally(()=>{o.set("")})},children:[e.jsx(w,{className:"mr-1 h-4 w-4"}),"Delete Request"]})})]}),s.status==="sent"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full flex-grow items-center justify-center",children:e.jsxs("span",{className:" flex flex-col items-center text-green-500",children:[e.jsx(A,{additionalClasses:"mr-2 h-8 w-8 mb-1"}),"Request Sent"]})}),e.jsxs(e.Fragment,{children:[m!=="sent"&&e.jsxs("button",{className:"flex w-full items-center justify-center border-t py-2 text-sm font-medium text-red-700 hover:bg-red-50/50 hover:text-red-500",onClick:()=>{f("sent")},children:[e.jsx(w,{className:"mr-1 h-4 w-4"}),"Withdraw Request"]}),m==="sent"&&e.jsxs("span",{className:"flex w-full items-center justify-center border-t py-2 text-sm text-red-700",children:["Are you sure?"," ",e.jsx("button",{className:"ml-2 font-medium text-red-700 underline underline-offset-2 hover:text-red-500",onClick:()=>{d(s.userId,"Friend request withdrawn").finally(()=>{o.set("")})},children:"Yes"})," ",e.jsx("button",{className:"ml-2 font-medium text-red-700 underline underline-offset-2 hover:text-red-500",onClick:()=>{f(void 0)},children:"No"})]})]})]}),s.status==="received"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full flex-grow flex-col items-center justify-center px-4",children:[e.jsx(N,{additionalClasses:"mr-2 h-8 w-8 mb-1 text-green-500"}),e.jsx("span",{className:"mb-3 text-green-600",children:"Request Received"}),e.jsx("button",{onClick:()=>{y(s.userId,"Friend request accepted").finally(()=>{o.set("")})},className:"mb-1 block w-full max-w-[150px] rounded-md bg-black py-1.5 text-sm text-white",children:"Accept"}),e.jsx("button",{onClick:()=>{d(s.userId,"Friend request rejected").finally(()=>{o.set("")})},className:"block w-full max-w-[150px] rounded-md border border-red-500 py-1 text-sm text-red-500",children:"Reject"})]})})]},s.userId)})}function O(c){const{onClose:s,befriendUrl:n}=c,{isCopied:l,copyText:a}=R(),m=u.useRef(null);return E(m,()=>{s()}),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:m,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-1.5 text-xl font-medium sm:text-2xl",children:"Invite URL"}),e.jsx("p",{className:"mb-3 hidden text-sm leading-none text-gray-400 sm:block",children:"Share the link below with your friends to invite them."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2 sm:mt-4",children:[e.jsx("input",{readOnly:!0,className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",value:n,onClick:d=>{d?.target?.select(),a(n)}}),e.jsxs("button",{className:`flex items-center justify-center gap-1 rounded-md border-0 px-3 py-2.5 text-sm text-black ${l?"bg-green-300 hover:bg-green-300":"bg-gray-200 hover:bg-gray-300"}`,onClick:()=>{a(n)},children:[e.jsx("img",{src:I.src,className:"h-4 w-4",alt:"Invite Friends"}),l?"Copied":"Copy URL"]})]})]})})})}const k=[{label:"Active",value:"active",statuses:["accepted"]},{label:"Requests",value:"requests",statuses:["received","rejected"]},{label:"Sent",value:"sent",statuses:["sent","got_rejected"]}];function ue(){const c=F(),[s,n]=u.useState(!1),[l,a]=u.useState(),[m,f]=u.useState(!0),[d,y]=u.useState([]),[i,j]=u.useState("active");async function b(){const{response:t,error:x}=await $("https://api.roadmap.sh/v1-list-friends");if(x||!t){c.error(x?.message||"Something went wrong");return}y(t)}u.useEffect(()=>{b().finally(()=>{o.set(""),f(!1)})},[]);const g=`https://roadmap.sh/befriend?u=${q()?.id}`,h=k.find(t=>t.value===i),v=d.filter(t=>h?.statuses.includes(t.status)),S=d.filter(t=>t.status==="received");return m?null:d?.length?e.jsxs("div",{children:[s&&e.jsx(O,{befriendUrl:g,onClose:()=>n(!1)}),l&&e.jsx(L,{userId:l.friend.userId,resourceId:l.resourceId,resourceType:"roadmap",onClose:()=>a(void 0)}),e.jsxs("div",{className:"mb-4 flex flex-col items-stretch justify-between gap-2 sm:flex-row sm:items-center sm:gap-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:k.map(t=>{let x=0;return t.value==="requests"&&(x=S.length),e.jsxs("button",{className:`relative flex items-center justify-center rounded-md border p-1 px-3 text-sm ${i===t.value?" border-gray-400 bg-gray-200 ":""} w-full sm:w-auto`,onClick:()=>j(t.value),children:[t.label,x>0&&e.jsx("span",{className:"ml-1.5 inline-flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] text-white",children:x})]},t.value)})}),e.jsxs("button",{onClick:()=>{n(!0)},className:"flex items-center justify-center gap-1.5 rounded-md border border-gray-400 bg-gray-50 p-1 px-2 text-sm hover:border-gray-500 hover:bg-gray-100",children:[e.jsx(N,{additionalClasses:"w-4 h-4"}),"Invite Friends"]})]}),v.length>0&&e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:v.map(t=>e.jsx(M,{friend:t,onShowResourceProgress:x=>{a({resourceId:x,friend:t})},onReload:()=>{o.set("Reloading friends .."),b().finally(()=>{o.set("")})}},t.userId))}),v.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("img",{src:T.src,alt:"Empty Friends",className:"mb-3 w-12 opacity-20"}),e.jsxs("h2",{className:"text-lg font-semibold",children:[i==="active"&&"No friends yet",i==="sent"&&"No requests sent",i==="requests"&&"No requests received"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Invite your friends to join you on Roadmap"}),e.jsxs("button",{onClick:()=>{n(!0)},className:"mt-4 flex items-center justify-center gap-1.5 rounded-md border border-gray-400 bg-gray-50 p-1 px-2 text-sm hover:border-gray-500 hover:bg-gray-100",children:[e.jsx(N,{additionalClasses:"w-4 h-4"}),"Invite Friends"]})]})]}):e.jsx(G,{befriendUrl:g})}export{ue as FriendsPage};
