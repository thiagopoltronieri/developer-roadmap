import{j as e}from"./jsx-runtime.391947bd.js";import{g as P}from"./browser.bcc09af3.js";import{r as n}from"./index.ed373d49.js";import{a as y,d as w}from"./http.64a7434f.js";import{p as d}from"./page.c1a8a472.js";import{E as _}from"./external-link.c102f3b3.js";import{R as L}from"./roadmap.98480e4e.js";import{U,S as D}from"./SelectRoadmapModal.ae6f9a6e.js";import{u as z}from"./index.9435383e.js";import{a as G}from"./team.12f2469e.js";import{u as Y}from"./use-toast.fb52de5d.js";import"./jwt.1b92699e.js";import"./index.a98c85f5.js";import"./index.es.ebad3893.js";import"./Spinner.cc2f813e.js";import"./resource-progress.495f7d07.js";/* empty css                       */import"./use-outside-click.54b69c89.js";import"./use-keydown.0305ad6b.js";import"./close.bb7a0ac2.js";import"./toast.1fe7142d.js";const q={src:"/_astro/plus.785206f9.svg",width:24,height:24,format:"svg"};function ce(){const{t:o}=P(),m=z(G),s=Y(),[C,g]=n.useState(!0),[b,f]=n.useState(""),[A,l]=n.useState(!1),[x,v]=n.useState(""),[p,k]=n.useState(),[c,u]=n.useState([]),[R,I]=n.useState([]);async function T(){const{error:r,response:t}=await y("/pages.json");if(r){s.error(r.message||"Something went wrong");return}if(!t)return[];const a=t.filter(i=>i.group==="Roadmaps").sort((i,h)=>i.title==="Android"?1:i.title.localeCompare(h.title));return I(a),t}async function S(r){const{response:t,error:a}=await y(`https://api.roadmap.sh/v1-get-team/${r}`);if(a||!t){s.error("Error loading team"),window.location.href="/account";return}k(t)}async function $(r){const{error:t,response:a}=await y(`https://api.roadmap.sh/v1-get-team-resource-config/${r}`);if(t||!Array.isArray(a)){console.error(t);return}u(a)}n.useEffect(()=>{o&&(g(!0),Promise.all([S(o),$(o),T()]).finally(()=>{d.set(""),g(!1)}))},[o]);async function E(r){if(!p?._id)return;s.loading("Deleting roadmap"),d.set("Deleting roadmap from team");const{error:t,response:a}=await w(`https://api.roadmap.sh/v1-delete-team-resource-config/${p._id}`,{resourceId:r,resourceType:"roadmap"});if(t||!a){s.error(t?.message||"Something went wrong");return}s.success("Roadmap removed"),u(a)}async function M(r){if(!o)return;s.loading("Adding roadmap"),d.set("Adding roadmap"),g(!0);const{error:t,response:a}=await w(`https://api.roadmap.sh/v1-update-team-resource-config/${o}`,{teamId:o,resourceId:r,resourceType:"roadmap",removed:[]});if(t||!a){s.error(t?.message||"Error adding roadmap");return}u(a),s.success("Roadmap added")}async function j(r){d.set("Removing roadmap"),E(r).finally(()=>{d.set("")})}if(!p)return null;const N=A&&e.jsx(D,{onClose:()=>l(!1),teamResourceConfig:c,allRoadmaps:R,teamId:o,onRoadmapAdd:r=>{M(r).finally(()=>{d.set("")})},onRoadmapRemove:r=>{confirm("Are you sure you want to remove this roadmap?")&&j(r).finally(()=>{})}});return c.length===0&&!C?e.jsxs("div",{className:"flex flex-col items-center p-4 py-20",children:[N,e.jsx("img",{alt:"roadmap",src:L.src,className:"mb-4 h-24 w-24 opacity-10"}),e.jsx("h3",{className:"mb-1 text-2xl font-bold text-gray-900",children:"No roadmaps"}),e.jsx("p",{className:"text-base text-gray-500",children:m?"Add a roadmap to start tracking your team":"Ask your team admin to add some roadmaps"}),m&&e.jsx("button",{className:"mt-4 rounded-lg bg-black px-4 py-2 font-medium text-white hover:bg-gray-900",onClick:()=>l(!0),children:"Add roadmap"})]}):e.jsxs("div",{children:[N,e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-400",children:[c.length," roadmap(s) selected"]}),m&&e.jsx("button",{className:"flex items-center gap-1.5 rounded-lg px-4 py-2 text-sm font-medium text-gray-500 underline hover:bg-gray-100 hover:text-gray-900",onClick:()=>l(!0),children:"Add / Remove Roadmaps"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[x&&e.jsx(U,{onClose:()=>v(""),resourceId:x,resourceType:"roadmap",teamId:p?._id,setTeamResourceConfig:u,defaultRemovedItems:c.find(r=>r.resourceId===x)?.removed||[]}),c.map(r=>{const{resourceId:t,removed:a}=r,i=R.find(h=>h.id===t)?.title||"...";return e.jsxs("div",{className:"flex flex-col items-start rounded-md border border-gray-300",children:[e.jsxs("div",{className:"w-full px-3 py-4",children:[e.jsxs("a",{href:`/${t}?t=${o}`,className:"group mb-0.5 flex items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:[i,e.jsx("img",{alt:"link",src:_.src,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})]}),a.length>0?e.jsxs("span",{className:"text-xs leading-none text-gray-900",children:[a.length," topic",a.length>1?"s":""," removed"]}):e.jsx("span",{className:"text-xs italic leading-none text-gray-400/60",children:"No changes made .."})]}),m&&e.jsxs("div",{className:"flex w-full justify-between px-3 pb-3 pt-2",children:[e.jsx("button",{type:"button",className:"text-xs text-gray-500 underline hover:text-black focus:outline-none",onClick:()=>{f(""),v(t)},children:"Customize"}),b!==t&&e.jsx("button",{type:"button",className:"text-xs text-red-500 underline hover:text-black focus:outline-none disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:text-red-500",onClick:()=>f(t),children:"Remove"}),b===t&&e.jsxs("span",{className:"text-xs",children:["Are you sure?"," ",e.jsx("button",{onClick:()=>j(t),className:"mx-0.5 text-red-500 underline underline-offset-1",children:"Yes"})," ",e.jsx("button",{onClick:()=>f(""),className:"text-red-500 underline underline-offset-1",children:"No"})]})]})]},t)}),m&&e.jsxs("button",{onClick:()=>l(!0),className:"group flex min-h-[110px] flex-col items-center justify-center rounded-md border border-dashed border-gray-300 transition-colors hover:border-gray-600 hover:bg-gray-50",children:[e.jsx("img",{alt:"add",src:q.src,className:"mb-1 h-6 w-6 opacity-20 transition-opacity group-hover:opacity-100"}),e.jsx("span",{className:"text-sm text-gray-400 transition-colors focus:outline-none group-hover:text-black",children:"Add Roadmap"})]})]})]})}export{ce as TeamRoadmaps};
