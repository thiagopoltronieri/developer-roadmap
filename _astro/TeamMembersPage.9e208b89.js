import{j as e}from"./jsx-runtime.391947bd.js";import{r as a}from"./index.ed373d49.js";import{c as E,h as D,d as B,a as P,b as $}from"./http.64a7434f.js";import{u as z}from"./use-auth.2b975076.js";import{p as f}from"./page.c1a8a472.js";import{u as k}from"./use-team-id.b856293f.js";import{u as S}from"./use-outside-click.54b69c89.js";import{R as L}from"./RoleDropdown.d684c525.js";import{g as A}from"./browser.bcc09af3.js";import{u as U}from"./index.9435383e.js";import{a as _}from"./team.12f2469e.js";import{u as F}from"./use-toast.fb52de5d.js";import"./jwt.1b92699e.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";function O(r){const{onClose:s}=r,i=a.useRef(null),u=a.useRef(null),[d,p]=a.useState(""),[m,n]=a.useState(!1),[x,c]=a.useState(""),{teamId:l}=k();a.useEffect(()=>{c(""),p(""),u?.current?.focus()},[]);const g=async h=>{if(h.preventDefault(),n(!0),c(""),d.toUpperCase()!=="LEAVE"){c("Verification text does not match"),n(!1);return}const{response:v,error:b}=await E(`https://api.roadmap.sh/v1-leave-team/${l}`,{});if(b||!v){n(!1),c(b?.message||"Something went wrong");return}window.location.href="/account?c=tl"},j=()=>{n(!1),c(""),p(""),s()};return S(i,j),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:i,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black",children:"Leave Team"}),e.jsx("p",{className:"text-gray-500",children:"You will lose access to the team, the roadmaps and progress of other team members."}),e.jsx("p",{className:"-mb-2 mt-3 text-base font-medium text-black",children:'Please type "leave" to confirm.'}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"my-4",children:[e.jsx("input",{ref:u,type:"text",name:"leave-team",id:"leave-team",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:'Type "leave" to confirm',required:!0,autoFocus:!0,value:d,onInput:h=>p(h.target.value)}),x&&e.jsx("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:x})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:m,onClick:j,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m||d.toUpperCase()!=="LEAVE",className:"flex-grow cursor-pointer rounded-lg bg-red-500 py-2 text-white disabled:opacity-40",children:m?"Please wait ..":"Leave Team"})]})]})]})})})}function V(r){const[s,i]=a.useState(!1);return e.jsxs(e.Fragment,{children:[s&&e.jsx(O,{onClose:()=>{i(!1)}}),e.jsx("button",{onClick:()=>{i(!0)},className:"flex h-7 min-w-[95px] items-center justify-center rounded-md border border-gray-200 bg-gray-50 px-2 py-1.5 text-sm font-medium leading-none text-red-600",children:"Leave team"})]})}function Y(r){const{onClose:s,onInvited:i}=r,u=a.useRef(null),d=a.useRef(null),[p,m]=a.useState("member"),[n,x]=a.useState(""),[c,l]=a.useState(!1),[g,j]=a.useState(""),{teamId:h}=k();a.useEffect(()=>{d?.current?.focus()},[]);const v=async y=>{y.preventDefault(),l(!0),j("");const{response:R,error:N}=await D(`https://api.roadmap.sh/v1-invite-member/${h}`,{email:n,role:p});if(N||!R){l(!1),j(N?.message||"Something went wrong");return}l(!1),b(),i()},b=()=>{l(!1),j(""),s()};return S(u,b),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:u,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-1.5 text-xl font-medium sm:text-2xl",children:"Invite Member"}),e.jsx("p",{className:"mb-3 hidden text-sm leading-none text-gray-400 sm:block",children:"Enter the email and role below to invite a member."}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"my-4 mt-0 flex flex-col gap-2 sm:mt-4",children:[e.jsx("input",{ref:d,type:"email",name:"invite-member",id:"invite-member",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:"Enter email address",required:!0,autoFocus:!0,value:n,onInput:y=>x(y.target.value)}),e.jsx("div",{className:"flex h-[42px] w-full flex-col",children:e.jsx(L,{className:"h-full w-full",selectedRole:p,setSelectedRole:m})}),g&&e.jsx("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:g})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:c,onClick:b,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c||!n,className:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:c?"Please wait ..":"Invite"})]})]})]})})})}function q(r){const{onClose:s,onUpdated:i,member:u}=r,d=a.useRef(null),[p,m]=a.useState(u.role),[n,x]=a.useState(!1),[c,l]=a.useState(""),{teamId:g}=k(),j=async v=>{v.preventDefault(),x(!0),l("");const{response:b,error:y}=await B(`https://api.roadmap.sh/v1-update-member-role/${g}/${u._id}`,{role:p});if(y||!b){x(!1),l(y?.message||"Something went wrong");return}x(!1),i()},h=()=>{x(!1),l(""),s()};return S(d,h),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:d,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-1.5 text-xl font-medium sm:text-2xl",children:"Update Role"}),e.jsx("p",{className:"mb-3 hidden text-sm leading-none text-gray-400 sm:block",children:"Select the role to update for this member"}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"my-4 mt-0 flex flex-col gap-2 sm:mt-4",children:[e.jsx("span",{className:"mt-2 block w-full rounded-md bg-gray-100 p-2",children:u.invitedEmail}),e.jsx("div",{className:"flex h-[42px] w-full flex-col",children:e.jsx(L,{className:"h-full w-full",selectedRole:p,setSelectedRole:m})}),c&&e.jsx("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:n,onClick:h,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n||!p,className:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:n?"Please wait ..":"Update Role"})]})]})]})})})}const G={src:"/_astro/more-vertical.f7e8fcb5.svg",width:24,height:24,format:"svg"};function H({member:r,onUpdateMember:s,onDeleteMember:i,onResendInvite:u,isDisabled:d=!1,onSendProgressReminder:p,allowProgressReminder:m=!1,allowUpdateRole:n=!0}){const x=a.useRef(null),[c,l]=a.useState(!1),[g,j]=a.useState(!1);S(x,()=>{l(!1)});const h=[{name:"Delete",handleClick:()=>{i(),l(!1)}},...n?[{name:"Update Role",handleClick:()=>{s(),l(!1)}}]:[],...m?[{name:"Send Progress Reminder",handleClick:()=>{p(),l(!1)}}]:[],...["invited"].includes(r.status)?[{name:"Resend Invite",handleClick:()=>{u(),l(!1)}}]:[]];return e.jsxs("div",{className:"relative",children:[e.jsx("button",{disabled:d,onClick:()=>l(!c),className:"ml-2 flex items-center opacity-60 transition-opacity hover:opacity-100 disabled:cursor-not-allowed disabled:opacity-30",children:e.jsx("img",{alt:"menu",src:G.src,className:"h-4 w-4"})}),c&&e.jsx("div",{ref:x,className:"align-right absolute right-0 top-full z-50 mt-1 w-[200px] rounded-md bg-slate-800 px-2 py-2 text-white shadow-md",children:e.jsx("ul",{children:h.map((v,b)=>e.jsx("li",{children:e.jsx("button",{onClick:v.handleClick,disabled:g,className:"flex w-full cursor-pointer items-center rounded p-2 text-sm font-medium text-slate-100 hover:bg-slate-700",children:v.name})},b))})})]})}function T({role:r}){return e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs sm:flex items-center capitalize ${["admin"].includes(r)?"bg-blue-100 text-blue-700 ":"bg-gray-100 text-gray-700 "} ${["manager"].includes(r)?"bg-green-100 text-green-700":""}`,children:r})}function M(r){const{member:s,index:i,onResendInvite:u,onUpdateMember:d,canManageCurrentTeam:p,userId:m,onDeleteMember:n,onSendProgressReminder:x}=r,c=U(_),l=!s.hasProgress&&s.status==="joined",g=c&&!s.hasProgress&&s.status==="joined"&&s.userId!==m;return e.jsxs("div",{className:`flex items-center justify-between gap-2 p-3 ${i===0?"":"border-t"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"hidden h-10 w-10 rounded-full sm:block"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 flex items-center gap-2 sm:hidden",children:e.jsx(T,{role:s.role})}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("h3",{className:"inline-grid grid-cols-[auto_auto_auto] items-center font-medium",children:[e.jsx("span",{className:"truncate",children:s.name}),l&&e.jsx("span",{className:"ml-2 rounded-full bg-red-400 px-2 py-0.5 text-xs font-normal text-white",children:"No Progress"}),s.userId===m&&e.jsx("span",{className:"ml-2 hidden text-xs font-normal text-blue-500 sm:inline",children:"You"})]}),e.jsxs("div",{className:"ml-2 flex items-center gap-0.5",children:[s.status==="invited"&&e.jsx("span",{className:"rounded-full bg-yellow-100 px-2 py-0.5 text-xs text-yellow-700",children:"Invited"}),s.status==="rejected"&&e.jsx("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700",children:"Rejected"})]})]}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:s.invitedEmail})]})]}),e.jsxs("div",{className:"flex shrink-0 items-center text-sm",children:[e.jsx("span",{className:"hidden sm:block",children:e.jsx(T,{role:s.role})}),p&&e.jsx(H,{allowUpdateRole:s.status!=="rejected",allowProgressReminder:g,onResendInvite:u,onSendProgressReminder:x,onDeleteMember:n,isDisabled:s.userId===m,onUpdateMember:d,member:s})]})]})}function de(){const{t:r}=A(),s=F(),i=U(_),[u,d]=a.useState(),[p,m]=a.useState(!1),[n,x]=a.useState([]),[c,l]=a.useState(),g=z();async function j(){const{response:t,error:o}=await P(`https://api.roadmap.sh/v1-get-team/${r}`);if(o||!t){s.error(o?.message||"Something went wrong");return}t&&l(t)}async function h(){const{response:t,error:o}=await P(`https://api.roadmap.sh/v1-get-team-member-list/${r}`);if(o||!t){s.error(o?.message||"Failed to load team member list");return}x(t)}a.useEffect(()=>{r&&Promise.all([j(),h()]).finally(()=>{f.set("")})},[r]);async function v(t,o){f.set("Deleting member");const{response:I,error:w}=await E(`https://api.roadmap.sh/v1-delete-member/${t}/${o}`,{});if(w||!I){s.error(w?.message||"Something went wrong");return}s.success("Member has been deleted"),await h()}async function b(t,o){f.set("Resending Invite");const{response:I,error:w}=await $(`https://api.roadmap.sh/v1-resend-invite/${t}/${o}`,{});if(w||!I){s.error(w?.message||"Something went wrong");return}s.success("Invite has been sent")}async function y(t,o){f.set("Sending Reminder");const{response:I,error:w}=await $(`https://api.roadmap.sh/v1-send-progress-reminder/${t}/${o}`,{});if(w||!I){s.error(w?.message||"Something went wrong");return}s.success("Reminder has been sent")}const R=n.filter(t=>t.status==="joined"),N=n.filter(t=>t.status==="invited"),C=n.filter(t=>t.status==="rejected");return e.jsxs("div",{children:[u&&e.jsx(q,{member:u,onUpdated:()=>{f.set("Refreshing members"),h().finally(()=>{f.set("")}),d(void 0),s.success("Member has been updated")},onClose:()=>{d(void 0)}}),p&&e.jsx(Y,{onInvited:()=>{s.success("Invite sent"),h().then(()=>null),m(!1)},onClose:()=>{m(!1)}}),e.jsxs("div",{children:[e.jsxs("div",{className:"rounded-md border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b p-3",children:[e.jsxs("p",{className:"hidden text-sm sm:block",children:[n.length," people in the team."]}),e.jsxs("p",{className:"block text-sm sm:hidden",children:[n.length," members"]}),e.jsx(V,{teamId:c?._id})]}),R.map((t,o)=>e.jsx(M,{member:t,index:o,teamId:r,userId:g?.id,onResendInvite:()=>{b(r,t._id).finally(()=>{f.set("")})},canManageCurrentTeam:i,onDeleteMember:()=>{v(r,t._id).finally(()=>{f.set("")})},onUpdateMember:()=>{d(t)},onSendProgressReminder:()=>{y(r,t._id).finally(()=>{f.set("")})}},o))]}),N.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-400",children:"Invited Members"}),e.jsx("div",{className:"mt-2 rounded-md border",children:N.map((t,o)=>e.jsx(M,{member:t,index:o,teamId:r,userId:g?.id,onResendInvite:()=>{b(r,t._id).finally(()=>{f.set("")})},canManageCurrentTeam:i,onDeleteMember:()=>{v(r,t._id).finally(()=>{f.set("")})},onUpdateMember:()=>{d(t)},onSendProgressReminder:()=>{y(r,t._id).finally(()=>{f.set("")})}},o))})]}),C.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-400",children:"Rejected Invites"}),e.jsx("div",{className:"mt-2 rounded-b-sm rounded-t-md border",children:C.map((t,o)=>e.jsx(M,{member:t,index:o,teamId:r,userId:g?.id,onResendInvite:()=>{b(r,t._id).finally(()=>{f.set("")})},canManageCurrentTeam:i,onDeleteMember:()=>{v(r,t._id).finally(()=>{f.set("")})},onUpdateMember:()=>{d(t)},onSendProgressReminder:()=>{y(r,t._id).finally(()=>{f.set("")})}},o))})]})]}),i&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{disabled:n.length>=25,onClick:()=>m(!0),className:"block w-full rounded-md border border-dashed border-gray-300 py-2 text-sm transition-colors hover:border-gray-600 hover:bg-gray-50 focus:outline-0",children:"+ Invite Member"})}),n.length>=25&&i&&e.jsx("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:"You have reached the maximum number of members in a team. Please reach out to us if you need more."})]})}export{de as TeamMembersPage};
